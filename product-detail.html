<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Chi tiết sản phẩm - Cà Phê Đậm Đà</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="styles/user.css" />
        <link rel="stylesheet" href="styles/header.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <style>
            /* Product detail specific tweaks */
            .product-detail { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin: 40px 0; }
            .product-gallery img { width: 100%; height: 500px; object-fit: cover; border-radius: 16px; }
            .product-title { font-family: "Playfair Display", serif; font-size: 32px; margin: 0; color: var(--coffee-900); }
            .product-price { font-size: 24px; font-weight: 600; color: var(--coffee); }
            .quantity-selector { display:flex; gap:12px; align-items:center; }
            .related-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:16px; }
            .add-to-cart { background: var(--coffee); color: #fff; border-radius: 10px; padding: 10px 18px; border: none; cursor: pointer; }
            .buy-now { background: #d6b692; color: var(--coffee-900); border-radius: 10px; padding: 10px 18px; border: none; cursor: pointer; }
            .quantity-selector button { width: 34px; height:34px; border-radius:6px; border:1px solid #ddd; background:#fff; cursor:pointer; }
            .quantity-selector input { width:72px; padding:6px; border-radius:6px; border:1px solid #ddd; }
            .related-grid .card { border:1px solid rgba(0,0,0,0.04); border-radius:10px; padding:8px; background:#fff; }
            /* New styles for enriched product detail */
            .product-info .meta { display:flex; gap:12px; align-items:center; margin:12px 0 18px 0; }
            .chip { background: rgba(222, 184, 135, 0.12); color: var(--coffee-900); padding:6px 10px; border-radius:8px; font-weight:600; font-size:13px; }
            .product-description { margin:12px 0 18px; line-height:1.6; color: #333; }
            .section { background:#fff; border-radius:10px; padding:12px 14px; margin-top:12px; box-shadow: 0 6px 18px rgba(0,0,0,0.04); }
            .section .section-title { font-size:16px; margin:0 0 8px 0; font-weight:600; color:var(--coffee-900); }
            .tasting-list { padding-left:18px; margin:0; }
            .tasting-list li { margin-bottom:6px; }
            .meta-row { display:flex; gap:10px; align-items:center; color:#666; font-size:14px; }
            .price-block { margin-left:auto; text-align:right; }
            @media (max-width:900px){ .product-detail{grid-template-columns:1fr; } .related-grid{grid-template-columns:1fr 1fr;} .product-gallery img { height:360px; } }
        </style>
    </head>
    <body>
        <!-- Header (same structure & behavior as index.html) -->
        <header class="header">
            <div class="container nav">
                <div class="brand">
                    <a href="index.html">
                        <img src="https://scontent-hkg4-2.xx.fbcdn.net/v/t1.15752-9/552703956_771855105468883_1116774372539651057_n.png?_nc_cat=111&ccb=1-7&_nc_sid=0024fc&_nc_eui2=AeHOBCj3lX8HaOlEvmrFw3xlBrfZDT56J6MGt9kNPnono-ZY8pwnFeBxIqW3onZN3zta5vYTCGt1khW091oaxsr0&_nc_ohc=gpp9itW4IqcQ7kNvwEoG1Qq&_nc_oc=Admu0eUlmvebDWAO50DQbndetZfv1eoK4Pdnm2Fql2WZTtukjFnDuqMCp5j7orfE930&_nc_ad=z-m&_nc_cid=0&_nc_zt=23&_nc_ht=scontent-hkg4-2.xx&oh=03_Q7cD3QHC08gLgVHXrZ8zt8znzke_wz-InehjvWetDnfV-WoDKQ&oe=68FBBCA9" alt="Logo" class="brand-logo"/>
                        <span class="brand-name">Cà Phê Đậm Đà</span>
                    </a>
                </div>

                <nav class="menu" aria-label="Chính">
                    <div class="dropdown">
                        <a href="products.html">Sản phẩm</a>
                        <div class="dropdown-content">
                            <a href="arabica.html">Arabica</a>
                            <a href="arabica.html">Robusta</a>
                            <a href="arabica.html">Blend</a>
                        </div>
                    </div>
                    <a href="index.html#ve-chung-toi">Giới thiệu</a>
                    <a href="index.html#lien-he">Liên hệ</a>

                    <div class="account-menu" id="accountMenu">
                        <div class="account-toggle" role="button" tabindex="0" aria-expanded="false">
                            <i class="fa fa-user"></i>
                            <span id="accountText">Đăng nhập / Đăng ký</span>
                            <i class="fa fa-caret-down"></i>
                        </div>
                        <ul class="account-dropdown" id="accountDropdown" aria-hidden="true"></ul>
                    </div>

                    <a href="cart.html" class="badge" aria-label="Giỏ hàng">
                        Giỏ hàng <span id="cart-badge" class="badge-count">0</span>
                    </a>
                </nav>

                <button id="menuBtn" class="mobile-toggle" aria-expanded="false" aria-controls="mobileMenu">Menu</button>
            </div>
        </header>

        <div class="page-banner" style="background:#fff7ef;border-bottom:1px solid #f2e6d9;">
            <div class="container" style="display:flex;align-items:center;justify-content:space-between;padding:10px 0;gap:12px;">
                <div style="display:flex;align-items:center;gap:10px;color:#2c1810;font-weight:600;">
                    <i class="fa fa-user-circle" aria-hidden="true"></i>
                    <span>Thông tin cá nhân</span>
                </div>
                <a href="profile.html" style="color:#e67e22;text-decoration:none;font-weight:600;">Xem hồ sơ</a>
            </div>
        </div>

        <!-- Mobile menu -->
        <nav id="mobileMenu" hidden style="position:fixed;inset:64px 16px auto;z-index:60;background:var(--coffee-900);color:#fff;border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.5);">
            <a href="#san-pham">Sản phẩm</a><br />
            <a href="#ve-chung-toi">Giới thiệu</a><br />
            <a href="#loi-ich">Lợi ích</a><br />
            <a href="#lien-he">Liên hệ</a>
        </nav>

        <!-- Auth modal removed (kept header/account as simple links) -->

        <!-- Main product detail container -->
        <main class="container">
            <div id="productDetail"></div>
        </main>

        <footer id="lien-he">
            <div class="container foot">
                <div><h4>Cà Phê Đậm Đà</h4><p>Hạt cà phê rang xay chất lượng cao. Đồng hành cùng ly cà phê ngon mỗi ngày.</p></div>
                <div><h4>Liên hệ</h4><p>Hotline: 0901 234 567<br/>Email: hello@caphedamda.vn</p></div>
                <div><h4>Địa chỉ</h4><p>123 Phin Street, Quận Caffeine, TP.HCM</p></div>
            </div>
            <div class="container copyright">2025 Cà Phê Đậm Đà. All rights reserved.</div>
        </footer>

        <script type="module">
            import { initHeader, updateCartBadge } from './scripts/header.js';
            // Mark prototype mode so header.js can simplify behavior when needed
            window.PROTOTYPE_MODE = true;
            // Initialize header behaviors (menu, cart link behavior)
            document.addEventListener('DOMContentLoaded', () => {
                initHeader();
                // render product and update badge from localStorage
                try { renderProduct(); } catch(e){}
                try { updateCartBadge(); } catch(e){}
            });

            // NOTE: Login/register modal & handlers removed from this page to simplify UX.
            // Header interactions (menu/cart) are handled by scripts/header.js which we import above.

            // Product detail (static single product) — enriched content
            const product = {
                id: 'p1',
                type: 'Arabica',
                name: 'Arabica Premium 250g',
                price: 135000,
                stock: 8,
                image: 'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?q=80&w=900&auto=format&fit=crop',
                desc: 'Hạt Arabica chọn lọc, rang vừa đủ để giữ được độ ngọt tự nhiên và hậu vị bền lâu. Sản phẩm mang đến trải nghiệm pha phin truyền thống lẫn pha tay hiện đại.',
                origin: 'Đà Lạt, Tây Nguyên (Vietnam)',
                roast: 'Rang: Trung-cao (Medium-Dark) — cân bằng giữa hương caramel và nốt chocolate nhẹ',
                aroma: 'Hương thơm ấm, gợi nhớ mùi bánh mì nướng và hoa khô khi mới xay.',
                tasting: [ 'Hương hoa nhè nhẹ', 'Vị caramel ngọt dịu', 'Hậu vị chocolate đắng ngọt, mượt mà' ],
                brewing: 'Gợi ý: Pour-over (V60) 15–18g / 250ml, nhiệt độ 92–95°C, thời gian chiết xuất 2:30–3:00. Với phin: 12–14g cho 120–150ml nước, thời gian 3–4 phút.',
                storage: 'Bảo quản nơi khô ráo, đậy kín sau khi mở để giữ trọn hương vị.'
            };
            function formatCurrency(v){ return new Intl.NumberFormat('vi-VN').format(v); }
            function createToast(html, timeout=2000){ const t=document.createElement('div'); t.innerHTML=html; t.style.position='fixed'; t.style.bottom='20px'; t.style.right='20px'; t.style.padding='12px 16px'; t.style.background='#4caf50'; t.style.color='#fff'; t.style.borderRadius='6px'; t.style.boxShadow='0 6px 20px rgba(0,0,0,0.12)'; t.style.zIndex=1200; document.body.appendChild(t); setTimeout(()=>{ try{ t.remove(); }catch(e){} }, timeout); }

            function renderProduct(){
                const detail = document.getElementById('productDetail');
                detail.innerHTML = `
                    <div class="product-detail">
                        <div class="product-gallery"><img src="${product.image}" alt="${product.name}"/></div>
                        <div class="product-info">
                            <h1 class="product-title">${product.name}</h1>
                            <div class="meta">
                                <span class="chip">${product.type}</span>
                                <div class="meta-row">${product.origin} · ${product.roast}</div>
                                <div class="price-block"><div class="product-price">${formatCurrency(product.price)}đ</div></div>
                            </div>
                            <div class="product-description">${product.desc} <em style="color:#666;display:block;margin-top:8px;">${product.aroma}</em></div>

                            <div class="section">
                                <div class="section-title">Hương vị & Ghi chú nếm</div>
                                <ul class="tasting-list">${product.tasting.map(t=>`<li>• ${t}</li>`).join('')}</ul>
                            </div>

                            <div class="section">
                                <div class="section-title">Gợi ý pha</div>
                                <div style="color:#444;">${product.brewing}</div>
                            </div>

                            <div class="section">
                                <div class="section-title">Bảo quản</div>
                                <div style="color:#444;">${product.storage}</div>
                            </div>

                            <div style="margin-top:14px;display:flex;gap:12px;align-items:center;">
                                <div class="button-group"><button id="addToCart" class="add-to-cart">Thêm vào giỏ hàng</button></div>
                            </div>
                        </div>
                    </div>
                    <section class="related-products"><h2 class="section-title">Sản phẩm liên quan</h2><div class="related-grid" id="relatedProducts"></div></section>
                `;
                const relatedImgs = ['https://images.unsplash.com/photo-1447933601403-0c6688de566e?q=80&w=400&auto=format&fit=crop','https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?q=80&w=400&auto=format&fit=crop','https://images.unsplash.com/photo-1511537190424-bbbab87ac5eb?q=80&w=400&auto=format&fit=crop'];
                const relatedContainer = document.getElementById('relatedProducts'); relatedContainer.innerHTML = relatedImgs.map((src,idx)=>`<article class="card" style="cursor:pointer;" onclick="window.location.href='product-detail.html'"><img src="${src}" alt="related"><div class="card-body"><span class="chip">${product.type}</span><div class="spacer"></div><div class="prod"><div><h4>${product.name}</h4><div><span class="price">${formatCurrency(product.price)}đ</span></div></div></div></div></article>`).join('');
                setupActions();
            }
            function setupActions(){ const add=document.getElementById('addToCart'); if(add){ add.addEventListener('click',()=>{ const user = JSON.parse(localStorage.getItem('currentUser')); if (!user) { alert('Vui lòng đăng nhập để sử dụng giỏ hàng'); openModal && openModal('login'); return; } createToast(`Đã thêm ${product.name} vào giỏ hàng`); }); } }

            // No additional boot required - header init will call renderProduct on DOMContentLoaded.
        </script>
        <script>
            // Header auth UI parity (like products.html)
            function getCurrentUser(){ try { return JSON.parse(localStorage.getItem('currentUser')||'null'); } catch { return null; } }
            function updateAuthUI(){
                const user = getCurrentUser();
                const accountText = document.getElementById('accountText');
                const loginItem = document.getElementById('loginItem');
                const registerItem = document.getElementById('registerItem');
                const profileItem = document.getElementById('profileItem');
                const logoutItem = document.getElementById('logoutItem');
                if (user){
                    if (accountText) accountText.textContent = user.name || 'Tài khoản';
                    if (loginItem) loginItem.style.display = 'none';
                    if (registerItem) registerItem.style.display = 'none';
                    if (profileItem) profileItem.style.display = 'block';
                    if (logoutItem) logoutItem.style.display = 'block';
                } else {
                    if (accountText) accountText.textContent = 'Đăng nhập / Đăng ký';
                    if (loginItem) loginItem.style.display = 'block';
                    if (registerItem) registerItem.style.display = 'block';
                    if (profileItem) profileItem.style.display = 'none';
                    if (logoutItem) logoutItem.style.display = 'none';
                }
            }
            document.addEventListener('DOMContentLoaded', function(){
                updateAuthUI();
                const toggle = document.querySelector('.account-toggle');
                const dropdown = document.getElementById('accountDropdown');
                toggle && toggle.addEventListener('click', function(e){ e.preventDefault(); if (dropdown){ dropdown.classList.toggle('show'); this.setAttribute('aria-expanded', dropdown.classList.contains('show')?'true':'false'); }});
                const logout = document.getElementById('logoutItem');
                if (logout){
                    const link = document.getElementById('logoutLink') || logout.querySelector('a');
                    link && link.addEventListener('click', function(e){ e.preventDefault(); localStorage.removeItem('currentUser'); updateAuthUI(); });
                }
                document.addEventListener('click', function(e){ const menu = document.getElementById('accountMenu'); if(menu && !menu.contains(e.target)){ dropdown && dropdown.classList.remove('show'); const t=document.querySelector('.account-toggle'); t && t.setAttribute('aria-expanded','false'); }});

                // Hide cart badge on detail page in prototype
                const badge = document.getElementById('cart-badge'); if (badge) badge.style.display = 'none';
            });
        </script>
    </body>
</html>
